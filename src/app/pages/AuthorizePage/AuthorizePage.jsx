import { useState, useEffect } from 'react'
import { useNavigate, useLocation, Link } from 'react-router-dom'
import { useAuthStore } from '@/features/auth'
import { LoginForm, RegisterForm } from '@/features/auth'
import googleIcon from '@/assets/icons/google.svg'
import steamIcon from '@/assets/icons/steam.svg'
import clsx from 'clsx'
import classes from './AuthorizePage.module.css'

const AuthorizePage = () => {
  const isAuthenticated = useAuthStore(state => state.isAuthenticated)
  const navigate = useNavigate()
  const location = useLocation()
  const [authView, setAuthView] = useState('login')

  useEffect(() => {
    if (isAuthenticated) {
      navigate(location.state?.from || '/', { replace: true })
    }
  }, [isAuthenticated, navigate, location])

  const toggleAuthView = () => {
    setAuthView(prev => prev === 'login' ? 'register' : 'login')
  }

  return (
    <div className={clsx(classes.wrapper, 'pageOpeningAnimation')}>
      <div className={classes.authWrapper}>
        <Link to="/" className={classes.homeButton} aria-label="Go to homepage">
          <svg width='151' height='48' viewBox='0 0 151 48' fill='currentColor' xmlns='http://www.w3.org/2000/svg'>
            <path d='M0 47.9219C0 47.8555 3.78439 42.361 8.40976 35.7118L16.8196 23.6225L8.95163 11.9244C4.62428 5.49049 1.08373 0.16328 1.08373 0.0861902C1.08373 0.00910367 5.25801 -0.0221572 10.3599 0.0167228L19.6361 0.0874153L23.0194 5.5299C24.8802 8.52326 26.5057 10.9384 26.6315 10.8968C26.7573 10.8552 28.3613 8.40607 30.196 5.45429L33.5317 0.0874153L42.9109 0.0167693C48.0694 -0.0220856 52.2901 0.0160529 52.2901 0.101597C52.2901 0.248455 47.6366 7.09833 40.1379 17.9894L36.7911 22.8503L38.9319 25.9763C40.1094 27.6956 43.969 33.3639 47.5089 38.5725L53.945 48.0426H44.3396H34.7343L30.8259 42.0808C28.6763 38.8017 26.7944 36.0782 26.644 36.0285C26.4936 35.9787 24.6199 38.6616 22.4803 41.9903L18.5901 48.0426H9.29506C4.18277 48.0426 0 47.9883 0 47.9219ZM79.6543 26.0128V16.6098H82.4991H85.3439V17.3053V18.0009L86.1647 17.316C87.5759 16.1385 89.7292 16.073 91.8337 17.1434C93.9203 18.2048 95.1317 20.4328 95.1761 23.291C95.2279 26.6223 94.0806 28.9123 91.7758 30.0783C90.2653 30.8424 87.4852 30.712 86.2184 29.8175L85.3439 29.2001V32.3079V35.4158H82.4991H79.6543V26.0128ZM88.873 25.274C89.6622 24.2826 89.5104 22.1266 88.6 21.3955C87.1798 20.2552 85.6156 21.1467 85.4178 23.209C85.2517 24.9408 86.0003 26.0128 87.3759 26.0128C88.0442 26.0128 88.4405 25.8172 88.873 25.274ZM102.179 30.5594C101.529 30.4327 100.601 30.0296 100.117 29.6637C98.6657 28.5657 98.3487 27.5549 98.3487 24.0244V20.9083H97.4004H96.4521V19.162V17.4158H97.4004H98.3487V15.4008V13.3859H101.193H104.038V15.4008V17.4158H105.664H107.289V19.162V20.9083H105.664H104.038V23.2933C104.038 26.0332 104.284 26.4467 105.752 26.1736L106.66 26.0048L106.98 27.4192C107.157 28.1972 107.369 29.0872 107.452 29.397C107.583 29.8909 107.405 30.015 106.005 30.4044C104.264 30.8891 103.938 30.9023 102.179 30.5594ZM51.7171 30.2093C49.3753 29.3795 48.1541 27.9735 47.5032 25.3576C47.0979 23.7293 47.0984 23.4586 47.5093 21.8075C47.754 20.8244 48.2689 19.6109 48.6536 19.1107C50.6351 16.5347 54.5879 15.6708 57.801 17.1115C58.9326 17.6189 60.4976 18.9771 60.9795 19.8699C61.2773 20.4218 61.1716 20.4947 58.5401 21.5529L56.7975 22.2536L56.2197 21.7153C55.5435 21.0854 54.5078 21.0192 53.7642 21.5583C53.3461 21.8615 53.2383 22.2658 53.2383 23.5319C53.2383 24.4866 53.3872 25.3021 53.6102 25.5685C54.1806 26.25 55.6687 26.1396 56.2637 25.3716L56.7605 24.7305L59.0139 25.7696L61.2674 26.8088L60.775 27.651C60.1647 28.6947 58.844 29.7232 57.5061 30.1966C56.213 30.6542 52.9925 30.6613 51.7171 30.2093ZM66.785 30.2479C63.6894 29.1446 62.2069 26.9221 62.2335 23.4246C62.2697 18.672 66.397 15.5818 71.3474 16.6009C74.6811 17.2871 76.945 20.0245 76.945 23.3691V24.9382H72.4723C68.1224 24.9382 68.0085 24.9524 68.3259 25.4564C69.0553 26.6145 70.8925 26.7335 72.3618 25.7178L73.0618 25.2338L74.5293 26.7182L75.9967 28.2026L75.0705 28.9784C74.5612 29.4052 73.5946 29.9401 72.9226 30.1671C71.5236 30.6398 68.0143 30.686 66.785 30.2479ZM71.2554 21.8026C71.2554 21.1139 70.4362 20.371 69.6768 20.371C68.8543 20.371 68.0042 21.0748 68.0042 21.7559C68.0042 22.1826 68.2303 22.2516 69.6298 22.2516C70.9682 22.2516 71.2554 22.1723 71.2554 21.8026ZM109.999 23.5949V16.6098H112.844H115.688V23.5949V30.58H112.844H109.999V23.5949ZM122.923 30.2078C119.927 29.1034 118.407 27.1464 118.188 24.1112C117.956 20.8896 119.423 18.3716 122.261 17.1244C124.262 16.2446 127.71 16.2351 129.641 17.1039C132.181 18.2461 133.524 20.1073 133.773 22.8301C134.05 25.8615 132.822 28.263 130.298 29.6283C129.033 30.3124 128.49 30.4343 126.39 30.5049C124.769 30.5595 123.607 30.4599 122.923 30.2078ZM126.997 25.8705C128.73 24.6667 127.945 20.9083 125.96 20.9083C124.481 20.9083 123.481 23.0843 124.188 24.7622C124.8 26.2151 125.885 26.643 126.997 25.8705ZM136.279 23.5949V16.6098H139.124H141.969V17.5708V18.5317L142.783 17.724C143.881 16.6356 145.966 16.1579 147.653 16.6084C149.108 16.9969 150.5 18.3553 150.898 19.7746C151.052 20.3243 151.178 22.9803 151.179 25.677V30.58H148.334H145.49V26.6099C145.49 23.4515 145.403 22.5177 145.068 22.0427C144.47 21.1962 143.246 21.2496 142.529 22.1535C142.02 22.795 141.967 23.2231 141.967 26.7207V30.58H139.123H136.278L136.279 23.5949ZM110.957 14.9307C109.595 13.7496 109.61 11.5218 110.987 10.4476C111.875 9.75495 113.69 9.71466 114.505 10.3695C116.743 12.1672 115.631 15.5143 112.791 15.5292C111.994 15.5334 111.447 15.3549 110.957 14.9307Z' />
          </svg>
        </Link>

        <div className={classes.formWrapper}>
          {authView === 'login' ? <LoginForm /> : <RegisterForm />}
        </div>

        <div className={classes.divider}></div>

        <div className={classes.icons}>
          <button
            className={classes.iconButton}
            type="button"
            aria-label="Sign in with Google"
          >
            <img src={googleIcon} alt="" />
          </button>
          <button
            className={classes.iconButton}
            type="button"
            aria-label="Sign in with Steam"
          >
            <img src={steamIcon} alt="" />
          </button>
        </div>

        <button
          className={classes.viewToggle}
          onClick={toggleAuthView}
          type="button"
        >
          {authView === 'login'
            ? "Don't have an account? Register"
            : "Already have an account? Login"}
        </button>
      </div>
    </div>
  )
}

export default AuthorizePage